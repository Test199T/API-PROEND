# Enhanced DDoS Protection Configuration
# Include this file in your main nginx.conf

# Additional rate limiting zones for DDoS protection
limit_req_zone $binary_remote_addr zone=strict:10m rate=1r/s;
limit_req_zone $binary_remote_addr zone=login:10m rate=3r/m;

# Connection limiting
limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;

# Block suspicious IPs (you can add more IPs here)
geo $blocked_ip {
    default 0;
    # Add suspicious IPs here
    # 1.2.3.4 1;
    # 5.6.7.8 1;
}

# Block requests from blocked IPs
if ($blocked_ip) {
    return 403;
}

# Block requests with suspicious patterns
if ($request_uri ~* "\.(php|asp|aspx|jsp)$") {
    return 403;
}

# Block requests with too many query parameters
if ($args ~ "^(.{1,1000})$") {
    # Allow normal requests
}
if ($args ~ "^(.{1001,})$") {
    return 400;
}

# Block requests with suspicious headers
if ($http_x_forwarded_for ~* "(\d{1,3}\.){3}\d{1,3}") {
    # Allow normal X-Forwarded-For
}
if ($http_x_forwarded_for ~* "(\d{1,3}\.){4,}\d{1,3}") {
    return 403;
}
